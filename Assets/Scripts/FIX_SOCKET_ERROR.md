# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞

## üêõ –ü—Ä–æ–±–ª–µ–º–∞:
```
–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è Relay —Ö–æ—Å—Ç–∞: –û–±—ã—á–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–¥—Ä–µ—Å–∞ —Å–æ–∫–µ—Ç–∞ (–ø—Ä–æ—Ç–æ–∫–æ–ª/—Å–µ—Ç–µ–≤–æ–π –∞–¥—Ä–µ—Å/–ø–æ—Ä—Ç).
```

## üîç –ü—Ä–∏—á–∏–Ω–∞:
- –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ "–°—Ç–∞—Ä—Ç" —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–∂–µ –∑–∞–Ω—è—Ç—ã–π –ø–æ—Ä—Ç
- –ü—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –°–æ–∫–µ—Ç—ã Windows —Ç—Ä–µ–±—É—é—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ö–æ—Å—Ç–∞:
```csharp
private async void CreateHostAsync()
{
    // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç—ã
    if (NetworkServer.active || NetworkClient.isConnected)
    {
        Disconnect();
        await System.Threading.Tasks.Task.Delay(500); // –ñ–¥–µ–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
    }
    
    // ... —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞
}
```

### 2. –£–ª—É—á—à–µ–Ω –º–µ—Ç–æ–¥ Disconnect():
```csharp
public void Disconnect()
{
    isSearchingForHost = false;
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ç–∏–ø—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
    if (NetworkServer.active && NetworkClient.isConnected)
        StopHost();
    else if (NetworkClient.isConnected)
        StopClient();
    else if (NetworkServer.active)
        StopServer();
    
    // –û—á–∏—â–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã –∏ –¥–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–æ–∫–µ—Ç–æ–≤
    hostAllocation = null;
    System.Threading.Thread.Sleep(100);
}
```

### 3. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞:
```csharp
private void SetupHostTransport()
{
    var transport = GetComponent<kcp2k.KcpTransport>();
    if (transport != null)
    {
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
        transport.ServerStop();
        transport.ClientDisconnect();
        
        // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–æ–∫–µ—Ç–æ–≤
        System.Threading.Thread.Sleep(50);
    }
}
```

### 4. –ó–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ:
```csharp
public override void OnStopHost()
{
    UpdateStatus("–ò–≥—Ä–∞ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞");
    UpdateUI();
    hostAllocation = null;
    
    // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–æ–∫–µ—Ç–æ–≤
    System.Threading.Thread.Sleep(100);
}
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–û—à–∏–±–∫–∞ —Å–æ–∫–µ—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å/–ø–æ–∫–∏–¥–∞—Ç—å –∏–≥—Ä—ã  
‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤** - —Å–æ–∫–µ—Ç—ã –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ  
‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞** - –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ä—Ç–æ–≤ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö  
‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø—Ä–∏ —Å–±–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ  

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏:**
```csharp
await System.Threading.Tasks.Task.Delay(1000); // –í–º–µ—Å—Ç–æ 500ms
```

2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Unity Editor** - –∏–Ω–æ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firewall** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Unity —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ç–∏

4. **–í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ - —Ä–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Ä—Ç:**
```csharp
// –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö kcp2k Transport
transport.Port = (ushort)UnityEngine.Random.Range(7000, 8000);
```

## üîß –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Unity Transport** –≤–º–µ—Å—Ç–æ kcp2k –¥–ª—è –ª—É—á—à–µ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Unity Relay:

```csharp
// –í–º–µ—Å—Ç–æ kcp2k Transport
var transport = GetComponent<Unity.Netcode.Transports.UTP.UnityTransport>();
transport.SetRelayServerData(/* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Relay */);
```

**–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫ —Å–æ–∫–µ—Ç–æ–≤!** üöÄ
